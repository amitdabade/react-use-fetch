"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("react");function r(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var t=r(e);const a=(e,r)=>{switch(r.type){case"UPDATE_STATUS":return{...e,fetching:r.payload.fetching,status:r.payload.status};case"UPDATE_ON_SUCCESS":case"UPDATE_ON_ERROR":return{...e,data:r.payload.data,error:r.payload.error,fetching:r.payload.fetching,status:r.payload.status,request:r.payload.request,response:r.payload.response};default:return{...e}}},n={data:null,error:null,fetching:!1,status:"idle",request:null,response:null},u={delay:0,retry:0,refetchInterval:0,refetch:1/0,responseType:"text"},s=e.createContext(u);exports.UseFetchProvider=function(r){const{config:a}=r,[n,c]=e.useState({...u,...a});return t.default.createElement(s.Provider,{value:{...n,updateGlobalConfig:e=>{c(e)}}},r.children)},exports.useFetch=(r,t)=>{const[u,c]=e.useReducer(a,n),l=e.useContext(s),o=e.useRef({refetch:t?.refetch??l.refetch,retry:t?.retry??l.retry,responseType:t?.responseType??l.responseType,delay:t?.delay??l.delay,refetchInterval:t?.refetchInterval??l.refetchInterval}),f=e.useRef(0),d=e.useRef(0),y=e.useRef(null),p=e.useRef(null);let i=e.useRef(null);e.useEffect((()=>()=>{clearTimeout(y.current),clearInterval(p.current)}),[]);const h=async e=>{let r=null,t=null,a=null;c({type:"UPDATE_STATUS",payload:{fetching:!0,status:"fetching"}}),i.current=new AbortController;try{r=new Request(e.url,{signal:i.current.signal,...e}),t=await fetch(r),a=await((e,r)=>{switch(r){case"json":return e.json();case"text":default:return e.text();case"blob":return e.blob();case"formData":return e.formData();case"arrayBuffer":return e.arrayBuffer()}})(t,o.current.responseType);try{a=JSON.parse(a)}catch(e){}c((e=>({type:"UPDATE_ON_SUCCESS",payload:e}))({fetching:!1,status:"success",data:a,error:null,request:r,response:t}))}catch(a){if(d.current===o.current.retry)return void c((e=>({type:"UPDATE_ON_ERROR",payload:e}))({fetching:!1,status:a?.message.includes("aborted")?"abort":"error",data:null,error:a,request:r,response:t}));v(e,o),d.current++}},v=(e,r)=>{if(0!==r.current.refetchInterval||r.current.refetch!==1/0)return h(e),void(p.current=setInterval((()=>{f.current!==r.current.refetch?(h(e),f.current++):clearInterval(p.current)}),r.current.refetchInterval));r.current.delay?y.current=setTimeout((()=>{h(e)}),r.current.delay):h(e)};return{...u,fetch:v.bind(void 0,r,o),abort:()=>{i.current.abort()}}};
